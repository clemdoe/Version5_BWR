***********************************************************
* Input file :  pincell_mphy_thm.x2m                      *
*                                                         *
* Test of a PWR single pincell                            *
*                                                         *
* The aim is to test the THM module of DONJON             *
***********************************************************
 
LINKED_LIST Geom Track Flux Cpo Matex Lib MicroF MacroF Macro2 Fmap
            System Power Burnup Thm DONNEES ;
MODULE      GEO: RESINI: TRIVAT: TRIVAA: GREP: FIND0: NCR: FLUD: FLPOW:
            MACINI: USPLIT: TINST: UTL: DELETE: ABORT: THM: END: ;

PROCEDURE   assertS ;
SEQ_ASCII   _ACompo ;
INTEGER     maxstep := 67 ;
REAL        Fuelpwr := 30.0796 ; ! W/g ou kW/kg ou MW/t
REAL        Mass := 6.464E-3 ; ! kg

*----
*  Calculation options
*----
STRING Dir := "EDI2B" ;
REAL   Tfuel := 900.0 ; (*fuel temperature (K)*)
REAL   Tcool := 543.15 ; (*coolant temperature (K)*)
REAL   Dfuel := 9.7413951 ; (*fuel density (g/cc)*)
REAL   dens_mod_0 := 0.65 ;
REAL   powi := 0.0384 ;
ECHO "total reactor power=" powi "MW" ;
*----
*  Recover the Multicompo
*----
Cpo := _ACompo ;
UTL: Cpo :: DIR ;

INTEGER MaxR := 10000 ;
INTEGER Iter := 1 ;
REAL keff11 keff12 keff1n ;
REAL Y1 Y2 ROOT YNEW ;
LOGICAL CONV ;
REAL maxh := 155 ;
REAL z1 := 0.9117647058823529 ;
REAL z2 := 1.8235294117647058 ;
REAL z3 := 2.735294117647059 ;
REAL z4 := 3.6470588235294117 ;
REAL z5 := 4.5588235294117645 ;
REAL z6 := 5.470588235294118 ;
REAL z7 := 6.382352941176471 ;
REAL z8 := 7.294117647058824 ;
REAL z9 := 8.205882352941178 ;
REAL z10 := 9.11764705882353 ;
REAL z11 := 10.029411764705884 ;
REAL z12 := 10.941176470588237 ;
REAL z13 := 11.85294117647059 ;
REAL z14 := 12.764705882352944 ;
REAL z15 := 13.676470588235297 ;
REAL z16 := 14.58823529411765 ;
REAL z17 := 15.500000000000004 ;
REAL z18 := 16.411764705882355 ;
REAL z19 := 17.323529411764707 ;
REAL z20 := 18.235294117647058 ;
REAL z21 := 19.14705882352941 ;
REAL z22 := 20.05882352941176 ;
REAL z23 := 20.970588235294112 ;
REAL z24 := 21.882352941176464 ;
REAL z25 := 22.794117647058815 ;
REAL z26 := 23.705882352941167 ;
REAL z27 := 24.61764705882352 ;
REAL z28 := 25.52941176470587 ;
REAL z29 := 26.44117647058822 ;
REAL z30 := 27.352941176470573 ;
REAL z31 := 28.264705882352924 ;
REAL z32 := 29.176470588235276 ;
REAL z33 := 30.088235294117627 ;
REAL z34 := 30.99999999999998 ;
REAL z35 := 31.91176470588233 ;
REAL z36 := 32.82352941176468 ;
REAL z37 := 33.73529411764704 ;
REAL z38 := 34.64705882352939 ;
REAL z39 := 35.55882352941175 ;
REAL z40 := 36.4705882352941 ;
REAL z41 := 37.38235294117646 ;
REAL z42 := 38.29411764705881 ;
REAL z43 := 39.20588235294117 ;
REAL z44 := 40.11764705882352 ;
REAL z45 := 41.02941176470588 ;
REAL z46 := 41.94117647058823 ;
REAL z47 := 42.85294117647059 ;
REAL z48 := 43.76470588235294 ;
REAL z49 := 44.6764705882353 ;
REAL z50 := 45.58823529411765 ;
REAL z51 := 46.50000000000001 ;
REAL z52 := 47.41176470588236 ;
REAL z53 := 48.32352941176472 ;
REAL z54 := 49.23529411764707 ;
REAL z55 := 50.14705882352943 ;
REAL z56 := 51.05882352941178 ;
REAL z57 := 51.97058823529414 ;
REAL z58 := 52.88235294117649 ;
REAL z59 := 53.79411764705885 ;
REAL z60 := 54.7058823529412 ;
REAL z61 := 55.61764705882356 ;
REAL z62 := 56.52941176470591 ;
REAL z63 := 57.44117647058827 ;
REAL z64 := 58.35294117647062 ;
REAL z65 := 59.26470588235298 ;
REAL z66 := 60.17647058823533 ;
REAL z67 := 61.08823529411769 ;
REAL z68 := 62.00000000000004 ;
REAL z69 := 62.9117647058824 ;
REAL z70 := 63.82352941176475 ;
REAL z71 := 64.7352941176471 ;
REAL z72 := 65.64705882352945 ;
REAL z73 := 66.5588235294118 ;
REAL z74 := 67.47058823529414 ;
REAL z75 := 68.38235294117649 ;
REAL z76 := 69.29411764705884 ;
REAL z77 := 70.20588235294119 ;
REAL z78 := 71.11764705882354 ;
REAL z79 := 72.02941176470588 ;
REAL z80 := 72.94117647058823 ;
REAL z81 := 73.85294117647058 ;
REAL z82 := 74.76470588235293 ;
REAL z83 := 75.67647058823528 ;
REAL z84 := 76.58823529411762 ;
REAL z85 := 77.49999999999997 ;
REAL z86 := 78.41176470588232 ;
REAL z87 := 79.32352941176467 ;
REAL z88 := 80.23529411764702 ;
REAL z89 := 81.14705882352936 ;
REAL z90 := 82.05882352941171 ;
REAL z91 := 82.97058823529406 ;
REAL z92 := 83.8823529411764 ;
REAL z93 := 84.79411764705875 ;
REAL z94 := 85.7058823529411 ;
REAL z95 := 86.61764705882345 ;
REAL z96 := 87.5294117647058 ;
REAL z97 := 88.44117647058815 ;
REAL z98 := 89.3529411764705 ;
REAL z99 := 90.26470588235284 ;
REAL z100 := 91.17647058823519 ;
REAL z101 := 92.08823529411754 ;
REAL z102 := 92.99999999999989 ;
REAL z103 := 93.91176470588223 ;
REAL z104 := 94.82352941176458 ;
REAL z105 := 95.73529411764693 ;
REAL z106 := 96.64705882352928 ;
REAL z107 := 97.55882352941163 ;
REAL z108 := 98.47058823529397 ;
REAL z109 := 99.38235294117632 ;
REAL z110 := 100.29411764705867 ;
REAL z111 := 101.20588235294102 ;
REAL z112 := 102.11764705882337 ;
REAL z113 := 103.02941176470571 ;
REAL z114 := 103.94117647058806 ;
REAL z115 := 104.85294117647041 ;
REAL z116 := 105.76470588235276 ;
REAL z117 := 106.6764705882351 ;
REAL z118 := 107.58823529411745 ;
REAL z119 := 108.4999999999998 ;
REAL z120 := 109.41176470588215 ;
REAL z121 := 110.3235294117645 ;
REAL z122 := 111.23529411764684 ;
REAL z123 := 112.14705882352919 ;
REAL z124 := 113.05882352941154 ;
REAL z125 := 113.97058823529389 ;
REAL z126 := 114.88235294117624 ;
REAL z127 := 115.79411764705858 ;
REAL z128 := 116.70588235294093 ;
REAL z129 := 117.61764705882328 ;
REAL z130 := 118.52941176470563 ;
REAL z131 := 119.44117647058798 ;
REAL z132 := 120.35294117647032 ;
REAL z133 := 121.26470588235267 ;
REAL z134 := 122.17647058823502 ;
REAL z135 := 123.08823529411737 ;
REAL z136 := 123.99999999999972 ;
REAL z137 := 124.91176470588206 ;
REAL z138 := 125.82352941176441 ;
REAL z139 := 126.73529411764676 ;
REAL z140 := 127.64705882352911 ;
REAL z141 := 128.55882352941146 ;
REAL z142 := 129.4705882352938 ;
REAL z143 := 130.38235294117615 ;
REAL z144 := 131.2941176470585 ;
REAL z145 := 132.20588235294085 ;
REAL z146 := 133.1176470588232 ;
REAL z147 := 134.02941176470554 ;
REAL z148 := 134.9411764705879 ;
REAL z149 := 135.85294117647024 ;
REAL z150 := 136.7647058823526 ;
REAL z151 := 137.67647058823493 ;
REAL z152 := 138.58823529411728 ;
REAL z153 := 139.49999999999963 ;
REAL z154 := 140.41176470588198 ;
REAL z155 := 141.32352941176433 ;
REAL z156 := 142.23529411764667 ;
REAL z157 := 143.14705882352902 ;
REAL z158 := 144.05882352941137 ;
REAL z159 := 144.97058823529372 ;
REAL z160 := 145.88235294117607 ;
REAL z161 := 146.7941176470584 ;
REAL z162 := 147.70588235294076 ;
REAL z163 := 148.6176470588231 ;
REAL z164 := 149.52941176470546 ;
REAL z165 := 150.4411764705878 ;
REAL z166 := 151.35294117647015 ;
REAL z167 := 152.2647058823525 ;
REAL z168 := 153.17647058823485 ;
REAL z169 := 154.0882352941172 ;
REAL z170 := 154.99999999999955 ;

REAL Cote      := 1.404  ;
Geom := GEO: :: CAR3D 1 1 170
   X- REFL X+ REFL    Y- REFL Y+ REFL    Z- REFL Z+ REFL
   MESHX 0.0 <<Cote>>
   MESHY 0.0 <<Cote>>
   MESHZ 0.0 <<z1>> <<z2>> <<z3>> <<z4>> <<z5>> <<z6>> <<z7>> <<z8>> 
            <<z9>> <<z10>> <<z11>> <<z12>> <<z13>> <<z14>> <<z15>> <<z16>> <<z17>> 
            <<z18>> <<z19>> <<z20>> <<z21>> <<z22>> <<z23>> <<z24>> <<z25>> <<z26>> 
            <<z27>> <<z28>> <<z29>> <<z30>> <<z31>> <<z32>> <<z33>> <<z34>> <<z35>> 
            <<z36>> <<z37>> <<z38>> <<z39>> <<z40>> <<z41>> <<z42>> <<z43>> <<z44>> 
            <<z45>> <<z46>> <<z47>> <<z48>> <<z49>> <<z50>> <<z51>> <<z52>> <<z53>> 
            <<z54>> <<z55>> <<z56>> <<z57>> <<z58>> <<z59>> <<z60>> <<z61>> <<z62>> 
            <<z63>> <<z64>> <<z65>> <<z66>> <<z67>> <<z68>> <<z69>> <<z70>> <<z71>> 
            <<z72>> <<z73>> <<z74>> <<z75>> <<z76>> <<z77>> <<z78>> <<z79>> <<z80>> 
            <<z81>> <<z82>> <<z83>> <<z84>> <<z85>> <<z86>> <<z87>> <<z88>> <<z89>> 
            <<z90>> <<z91>> <<z92>> <<z93>> <<z94>> <<z95>> <<z96>> <<z97>> <<z98>> 
            <<z99>> <<z100>> <<z101>> <<z102>> <<z103>> <<z104>> <<z105>> <<z106>> <<z107>> 
            <<z108>> <<z109>> <<z110>> <<z111>> <<z112>> <<z113>> <<z114>> <<z115>> <<z116>> 
            <<z117>> <<z118>> <<z119>> <<z120>> <<z121>> <<z122>> <<z123>> <<z124>> <<z125>> 
            <<z126>> <<z127>> <<z128>> <<z129>> <<z130>> <<z131>> <<z132>> <<z133>> <<z134>> 
            <<z135>> <<z136>> <<z137>> <<z138>> <<z139>> <<z140>> <<z141>> <<z142>> <<z143>> 
            <<z144>> <<z145>> <<z146>> <<z147>> <<z148>> <<z149>> <<z150>> <<z151>> <<z152>> 
            <<z153>> <<z154>> <<z155>> <<z156>> <<z157>> <<z158>> <<z159>> <<z160>> <<z161>> 
            <<z162>> <<z163>> <<z164>> <<z165>> <<z166>> <<z167>> <<z168>> <<z169>> <<z170>>
   MIX
   PLANE 1
      1
   PLANE 2  SAME 1
   PLANE 3  SAME 1
   PLANE 4  SAME 1
   PLANE 5  SAME 1
   PLANE 6  SAME 1
   PLANE 7  SAME 1
   PLANE 8  SAME 1
   PLANE 9  SAME 1
   PLANE 10  SAME 1
   PLANE 11  SAME 1
   PLANE 12  SAME 1
   PLANE 13  SAME 1
   PLANE 14  SAME 1
   PLANE 15  SAME 1
   PLANE 16  SAME 1
   PLANE 17  SAME 1
   PLANE 18  SAME 1
   PLANE 19  SAME 1
   PLANE 20  SAME 1
   PLANE 21  SAME 1
   PLANE 22  SAME 1
   PLANE 23  SAME 1
   PLANE 24  SAME 1
   PLANE 25  SAME 1
   PLANE 26  SAME 1
   PLANE 27  SAME 1
   PLANE 28  SAME 1
   PLANE 29  SAME 1
   PLANE 30  SAME 1
   PLANE 31  SAME 1
   PLANE 32  SAME 1
   PLANE 33  SAME 1
   PLANE 34  SAME 1
   PLANE 35  SAME 1
   PLANE 36  SAME 1
   PLANE 37  SAME 1
   PLANE 38  SAME 1
   PLANE 39  SAME 1
   PLANE 40  SAME 1
   PLANE 41  SAME 1
   PLANE 42  SAME 1
   PLANE 43  SAME 1
   PLANE 44  SAME 1
   PLANE 45  SAME 1
   PLANE 46  SAME 1
   PLANE 47  SAME 1
   PLANE 48  SAME 1
   PLANE 49  SAME 1
   PLANE 50  SAME 1
   PLANE 51  SAME 1
   PLANE 52  SAME 1
   PLANE 53  SAME 1
   PLANE 54  SAME 1
   PLANE 55  SAME 1
   PLANE 56  SAME 1
   PLANE 57  SAME 1
   PLANE 58  SAME 1
   PLANE 59  SAME 1
   PLANE 60  SAME 1
   PLANE 61  SAME 1
   PLANE 62  SAME 1
   PLANE 63  SAME 1
   PLANE 64  SAME 1
   PLANE 65  SAME 1
   PLANE 66  SAME 1
   PLANE 67  SAME 1
   PLANE 68  SAME 1
   PLANE 69  SAME 1
   PLANE 70  SAME 1
   PLANE 71  SAME 1
   PLANE 72  SAME 1
   PLANE 73  SAME 1
   PLANE 74  SAME 1
   PLANE 75  SAME 1
   PLANE 76  SAME 1
   PLANE 77  SAME 1
   PLANE 78  SAME 1
   PLANE 79  SAME 1
   PLANE 80  SAME 1
   PLANE 81  SAME 1
   PLANE 82  SAME 1
   PLANE 83  SAME 1
   PLANE 84  SAME 1
   PLANE 85  SAME 1
   PLANE 86  SAME 1
   PLANE 87  SAME 1
   PLANE 88  SAME 1
   PLANE 89  SAME 1
   PLANE 90  SAME 1
   PLANE 91  SAME 1
   PLANE 92  SAME 1
   PLANE 93  SAME 1
   PLANE 94  SAME 1
   PLANE 95  SAME 1
   PLANE 96  SAME 1
   PLANE 97  SAME 1
   PLANE 98  SAME 1
   PLANE 99  SAME 1
   PLANE 100  SAME 1
   PLANE 101  SAME 1
   PLANE 102  SAME 1
   PLANE 103  SAME 1
   PLANE 104  SAME 1
   PLANE 105  SAME 1
   PLANE 106  SAME 1
   PLANE 107  SAME 1
   PLANE 108  SAME 1
   PLANE 109  SAME 1
   PLANE 110  SAME 1
   PLANE 111  SAME 1
   PLANE 112  SAME 1
   PLANE 113  SAME 1
   PLANE 114  SAME 1
   PLANE 115  SAME 1
   PLANE 116  SAME 1
   PLANE 117  SAME 1
   PLANE 118  SAME 1
   PLANE 119  SAME 1
   PLANE 120  SAME 1
   PLANE 121  SAME 1
   PLANE 122  SAME 1
   PLANE 123  SAME 1
   PLANE 124  SAME 1
   PLANE 125  SAME 1
   PLANE 126  SAME 1
   PLANE 127  SAME 1
   PLANE 128  SAME 1
   PLANE 129  SAME 1
   PLANE 130  SAME 1
   PLANE 131  SAME 1
   PLANE 132  SAME 1
   PLANE 133  SAME 1
   PLANE 134  SAME 1
   PLANE 135  SAME 1
   PLANE 136  SAME 1
   PLANE 137  SAME 1
   PLANE 138  SAME 1
   PLANE 139  SAME 1
   PLANE 140  SAME 1
   PLANE 141  SAME 1
   PLANE 142  SAME 1
   PLANE 143  SAME 1
   PLANE 144  SAME 1
   PLANE 145  SAME 1
   PLANE 146  SAME 1
   PLANE 147  SAME 1
   PLANE 148  SAME 1
   PLANE 149  SAME 1
   PLANE 150  SAME 1
   PLANE 151  SAME 1
   PLANE 152  SAME 1
   PLANE 153  SAME 1
   PLANE 154  SAME 1
   PLANE 155  SAME 1
   PLANE 156  SAME 1
   PLANE 157  SAME 1
   PLANE 158  SAME 1
   PLANE 159  SAME 1
   PLANE 160  SAME 1
   PLANE 161  SAME 1
   PLANE 162  SAME 1
   PLANE 163  SAME 1
   PLANE 164  SAME 1
   PLANE 165  SAME 1
   PLANE 166  SAME 1
   PLANE 167  SAME 1
   PLANE 168  SAME 1
   PLANE 169  SAME 1
   PLANE 170  SAME 1
;

Geom Matex := USPLIT: Geom :: NGRP 2 MAXR <<MaxR>>
               NFUEL 1  FMIX  1
;

Track := TRIVAT: Geom ::
   EDIT 1 MAXR <<MaxR>> MCFD 1 ;

*--
* Fuel map definition
*--
Fmap Matex := RESINI: Matex ::
      ::: GEO: CAR3D 1 1 170
                EDIT  0
                X- REFL X+ REFL    Y- REFL Y+ REFL    Z- REFL Z+ REFL
   MESHX 0.0 <<Cote>>
   MESHY 0.0 <<Cote>>
   MESHZ 0.0 <<z1>> <<z2>> <<z3>> <<z4>> <<z5>> <<z6>> <<z7>> <<z8>> 
            <<z9>> <<z10>> <<z11>> <<z12>> <<z13>> <<z14>> <<z15>> <<z16>> <<z17>> 
            <<z18>> <<z19>> <<z20>> <<z21>> <<z22>> <<z23>> <<z24>> <<z25>> <<z26>> 
            <<z27>> <<z28>> <<z29>> <<z30>> <<z31>> <<z32>> <<z33>> <<z34>> <<z35>> 
            <<z36>> <<z37>> <<z38>> <<z39>> <<z40>> <<z41>> <<z42>> <<z43>> <<z44>> 
            <<z45>> <<z46>> <<z47>> <<z48>> <<z49>> <<z50>> <<z51>> <<z52>> <<z53>> 
            <<z54>> <<z55>> <<z56>> <<z57>> <<z58>> <<z59>> <<z60>> <<z61>> <<z62>> 
            <<z63>> <<z64>> <<z65>> <<z66>> <<z67>> <<z68>> <<z69>> <<z70>> <<z71>> 
            <<z72>> <<z73>> <<z74>> <<z75>> <<z76>> <<z77>> <<z78>> <<z79>> <<z80>> 
            <<z81>> <<z82>> <<z83>> <<z84>> <<z85>> <<z86>> <<z87>> <<z88>> <<z89>> 
            <<z90>> <<z91>> <<z92>> <<z93>> <<z94>> <<z95>> <<z96>> <<z97>> <<z98>> 
            <<z99>> <<z100>> <<z101>> <<z102>> <<z103>> <<z104>> <<z105>> <<z106>> <<z107>> 
            <<z108>> <<z109>> <<z110>> <<z111>> <<z112>> <<z113>> <<z114>> <<z115>> <<z116>> 
            <<z117>> <<z118>> <<z119>> <<z120>> <<z121>> <<z122>> <<z123>> <<z124>> <<z125>> 
            <<z126>> <<z127>> <<z128>> <<z129>> <<z130>> <<z131>> <<z132>> <<z133>> <<z134>> 
            <<z135>> <<z136>> <<z137>> <<z138>> <<z139>> <<z140>> <<z141>> <<z142>> <<z143>> 
            <<z144>> <<z145>> <<z146>> <<z147>> <<z148>> <<z149>> <<z150>> <<z151>> <<z152>> 
            <<z153>> <<z154>> <<z155>> <<z156>> <<z157>> <<z158>> <<z159>> <<z160>> <<z161>> 
            <<z162>> <<z163>> <<z164>> <<z165>> <<z166>> <<z167>> <<z168>> <<z169>> <<z170>>
   MIX
   PLANE 1
      1
   PLANE 2  SAME 1
   PLANE 3  SAME 1
   PLANE 4  SAME 1
   PLANE 5  SAME 1
   PLANE 6  SAME 1
   PLANE 7  SAME 1
   PLANE 8  SAME 1
   PLANE 9  SAME 1
   PLANE 10  SAME 1
   PLANE 11  SAME 1
   PLANE 12  SAME 1
   PLANE 13  SAME 1
   PLANE 14  SAME 1
   PLANE 15  SAME 1
   PLANE 16  SAME 1
   PLANE 17  SAME 1
   PLANE 18  SAME 1
   PLANE 19  SAME 1
   PLANE 20  SAME 1
   PLANE 21  SAME 1
   PLANE 22  SAME 1
   PLANE 23  SAME 1
   PLANE 24  SAME 1
   PLANE 25  SAME 1
   PLANE 26  SAME 1
   PLANE 27  SAME 1
   PLANE 28  SAME 1
   PLANE 29  SAME 1
   PLANE 30  SAME 1
   PLANE 31  SAME 1
   PLANE 32  SAME 1
   PLANE 33  SAME 1
   PLANE 34  SAME 1
   PLANE 35  SAME 1
   PLANE 36  SAME 1
   PLANE 37  SAME 1
   PLANE 38  SAME 1
   PLANE 39  SAME 1
   PLANE 40  SAME 1
   PLANE 41  SAME 1
   PLANE 42  SAME 1
   PLANE 43  SAME 1
   PLANE 44  SAME 1
   PLANE 45  SAME 1
   PLANE 46  SAME 1
   PLANE 47  SAME 1
   PLANE 48  SAME 1
   PLANE 49  SAME 1
   PLANE 50  SAME 1
   PLANE 51  SAME 1
   PLANE 52  SAME 1
   PLANE 53  SAME 1
   PLANE 54  SAME 1
   PLANE 55  SAME 1
   PLANE 56  SAME 1
   PLANE 57  SAME 1
   PLANE 58  SAME 1
   PLANE 59  SAME 1
   PLANE 60  SAME 1
   PLANE 61  SAME 1
   PLANE 62  SAME 1
   PLANE 63  SAME 1
   PLANE 64  SAME 1
   PLANE 65  SAME 1
   PLANE 66  SAME 1
   PLANE 67  SAME 1
   PLANE 68  SAME 1
   PLANE 69  SAME 1
   PLANE 70  SAME 1
   PLANE 71  SAME 1
   PLANE 72  SAME 1
   PLANE 73  SAME 1
   PLANE 74  SAME 1
   PLANE 75  SAME 1
   PLANE 76  SAME 1
   PLANE 77  SAME 1
   PLANE 78  SAME 1
   PLANE 79  SAME 1
   PLANE 80  SAME 1
   PLANE 81  SAME 1
   PLANE 82  SAME 1
   PLANE 83  SAME 1
   PLANE 84  SAME 1
   PLANE 85  SAME 1
   PLANE 86  SAME 1
   PLANE 87  SAME 1
   PLANE 88  SAME 1
   PLANE 89  SAME 1
   PLANE 90  SAME 1
   PLANE 91  SAME 1
   PLANE 92  SAME 1
   PLANE 93  SAME 1
   PLANE 94  SAME 1
   PLANE 95  SAME 1
   PLANE 96  SAME 1
   PLANE 97  SAME 1
   PLANE 98  SAME 1
   PLANE 99  SAME 1
   PLANE 100  SAME 1
   PLANE 101  SAME 1
   PLANE 102  SAME 1
   PLANE 103  SAME 1
   PLANE 104  SAME 1
   PLANE 105  SAME 1
   PLANE 106  SAME 1
   PLANE 107  SAME 1
   PLANE 108  SAME 1
   PLANE 109  SAME 1
   PLANE 110  SAME 1
   PLANE 111  SAME 1
   PLANE 112  SAME 1
   PLANE 113  SAME 1
   PLANE 114  SAME 1
   PLANE 115  SAME 1
   PLANE 116  SAME 1
   PLANE 117  SAME 1
   PLANE 118  SAME 1
   PLANE 119  SAME 1
   PLANE 120  SAME 1
   PLANE 121  SAME 1
   PLANE 122  SAME 1
   PLANE 123  SAME 1
   PLANE 124  SAME 1
   PLANE 125  SAME 1
   PLANE 126  SAME 1
   PLANE 127  SAME 1
   PLANE 128  SAME 1
   PLANE 129  SAME 1
   PLANE 130  SAME 1
   PLANE 131  SAME 1
   PLANE 132  SAME 1
   PLANE 133  SAME 1
   PLANE 134  SAME 1
   PLANE 135  SAME 1
   PLANE 136  SAME 1
   PLANE 137  SAME 1
   PLANE 138  SAME 1
   PLANE 139  SAME 1
   PLANE 140  SAME 1
   PLANE 141  SAME 1
   PLANE 142  SAME 1
   PLANE 143  SAME 1
   PLANE 144  SAME 1
   PLANE 145  SAME 1
   PLANE 146  SAME 1
   PLANE 147  SAME 1
   PLANE 148  SAME 1
   PLANE 149  SAME 1
   PLANE 150  SAME 1
   PLANE 151  SAME 1
   PLANE 152  SAME 1
   PLANE 153  SAME 1
   PLANE 154  SAME 1
   PLANE 155  SAME 1
   PLANE 156  SAME 1
   PLANE 157  SAME 1
   PLANE 158  SAME 1
   PLANE 159  SAME 1
   PLANE 160  SAME 1
   PLANE 161  SAME 1
   PLANE 162  SAME 1
   PLANE 163  SAME 1
   PLANE 164  SAME 1
   PLANE 165  SAME 1
   PLANE 166  SAME 1
   PLANE 167  SAME 1
   PLANE 168  SAME 1
   PLANE 169  SAME 1
   PLANE 170  SAME 1
;
!
NXNAME '01' NYNAME  'A'
NCOMB 1
B-ZONE 1

ADD-PARAM PNAME 'T-FUEL' PARKEY 'TFA' GLOBAL
ADD-PARAM PNAME 'T-COOL' PARKEY 'TCA' GLOBAL
ADD-PARAM PNAME 'D-FUEL' PARKEY 'DFA' GLOBAL
ADD-PARAM PNAME 'D-COOL' PARKEY 'DCA' GLOBAL
BTYPE INST-BURN
INST-BVAL CHAN 0.0
REACTOR-POW <<powi>> AXIAL-PFORM 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 1.0 
SET-PARAM 'T-FUEL' <<Tfuel>>
SET-PARAM 'T-COOL' <<Tcool>>
SET-PARAM 'D-FUEL' <<Dfuel>>
SET-PARAM 'D-COOL' <<dens_mod_0>>
FUEL WEIGHT <<Mass>>
;

UTL: Fmap :: STEP UP PARAM STEP AT 4 DIR IMPR P-NAME * ;
*--
* THM single-stage calculation
*--
Thm Fmap := THM: Fmap ::
    EDIT 100
    FLUID H2O
    FPUISS 1.0
    INLET 7.2E6 (*Pa*) 543.15 (*K*)
    INLET-Q 8.47029E-5 (*m2*) 0.084 (*inlet mass flow rate kg/s*)
    ASSMB 1 0
    RADIUS 4.435E-3 4.520E-3 5.14E-3 5.14E-3 (*m*)
    RODMESH 8 11  
    HGAP 10000.0
    CONDC 0 21.5 KELVIN
    CONDF 0 4.18 KELVIN
    BOWR
    PDROP 1 
    DFM 1 
;

*--
* Dump THM object
*--
UTL: Thm :: DIR DUMP ;

*--
* Cross-section database interpolation
*--
MicroF := NCR: Cpo Fmap ::
       EDIT 2
       MICRO LINEAR
       TABLE Cpo <<Dir>> 'burnup'
         MIX 1 INST-BURN
               SET LINEAR 'burnup' MAP
               SET CUBIC 'DCA' <<dens_mod_0>>
               SET CUBIC 'DCAH' <<dens_mod_0>>
               ADD 'DCA' <<dens_mod_0>> MAP
                        REF 'burnup' SAMEASREF
                        ENDREF
         ENDMIX
  ;
MacroF := MicroF :: STEP UP 'MACROLIB' ;
  
Macro2 Matex := MACINI: Matex MacroF :: FUEL ;
  
*--
* Steady-state diffusion calculation
*--
System := TRIVAA: Macro2 Track ;

Flux := FLUD: System Track :: EDIT 1 ADI 4 ACCE 5 3 ;
System MacroF Macro2 := DELETE: System MacroF Macro2 ;

GREP: Flux :: GETVAL 'K-EFFECTIVE' 1 >>keff11<< ;
ECHO "+++ Burnup= 0.0 Keff=" keff11 ;

*assertS Flux :: 'K-EFFECTIVE' 1 1.354165 ;

ECHO "test pincell_mphy_thm.x2m completed" ;
END: ;
