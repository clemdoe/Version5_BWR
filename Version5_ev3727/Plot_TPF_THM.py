import numpy as np 
import matplotlib.pyplot as plt
import pandas as pd 

def readTPF(file_path):
    # Charger les données
    df = pd.read_csv(file_path, delimiter=',', skipinitialspace=True)
    z = df['zPosition']
    # Convertir les colonnes de température en float
    TempVap = df['TempVap'].astype(float)
    TempLiq = df['TempLiq'].astype(float)
    TempFuelC = df['TempFuelC'].astype(float)
    TempStru = df['TempStru'].astype(float)
    Void = df['Void'].astype(float)
    Pressure = df['Pressure'].astype(float)
    VelzVap = df['VelzVap'].astype(float)
    VelzLiq = df['VelzLiq'].astype(float)

    for i in range(len(z)):
        TempVap[i] = TempVap[i] + 273.15
        TempLiq[i] = TempLiq[i] + 273.15
        TempFuelC[i] = TempFuelC[i] + 273.15
        TempStru[i] = TempStru[i] + 273.15
        
    return z, TempVap, TempLiq, TempFuelC, TempStru, Void, Pressure, VelzVap, VelzLiq


# Données brutes sous forme de chaîne de caractères
raw_data_0 = """PCOOL:   7214343.00       7213741.50       7213140.50       7212540.00       7211939.50       7211339.50       7210739.50       7210140.50       7209541.00       7208942.50       7208344.00       7207746.00       7207148.00       7206550.50       7205953.50       7205356.50       7204760.00       7204164.00       7203568.00       7202972.50       7202377.50       7201782.50       7201188.00       7200594.00       7200000.00    
 VCOOL:   1.28856492       1.28961909       1.29067171       1.29173470       1.29279423       1.29386306       1.29492974       1.29600608       1.29708052       1.29816306       1.29924941       1.30033696       1.30142891       1.30252469       1.30362487       1.30472767       1.30583715       1.30694664       1.30806339       1.30918074       1.31030595       1.31143272       1.31256473       1.31369948       1.31483805    
 DCOOL:   769.617004       768.987915       768.360718       767.728455       767.099243       766.465576       765.834167       765.198181       764.564331       763.926758       763.287903       762.649597       762.009583       761.368408       760.726074       760.083130       759.437317       758.792603       758.144714       757.497742       756.847046       756.197144       755.544678       754.892456       754.237366    
 TCOOL:   543.329163       543.685608       544.039795       544.395996       544.749390       545.104248       545.456848       545.810913       546.162781       546.515686       546.868225       547.219421       547.570496       547.921143       548.271423       548.620972       548.971008       549.319336       549.668396       550.015747       550.364197       550.711121       551.058289       551.404175       551.750549    
 EPS:   0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000    
 XFL:   0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000    
 TSAT:   561.028198       561.022522       561.016846       561.011169       561.005493       560.999817       560.994202       560.988525       560.982849       560.977173       560.971558       560.965881       560.960205       560.954590       560.948914       560.943298       560.937622       560.932007       560.926392       560.920715       560.915100       560.909485       560.903870       560.898254       560.892639    
 MUT:   9.80513869E-05   9.78959506E-05   9.77416494E-05   9.75866351E-05   9.74330032E-05   9.72788766E-05   9.71258851E-05   9.69723988E-05   9.68200038E-05   9.66672960E-05   9.65148793E-05   9.63631755E-05   9.62116537E-05   9.60604375E-05   9.59094905E-05   9.57589800E-05   9.56083750E-05   9.54586067E-05   9.53086346E-05   9.51594920E-05   9.50099784E-05   9.48612069E-05   9.47124281E-05   9.45642823E-05   9.44160056E-05
 HCOOL:   1186342.25       1188152.50       1189962.88       1191773.00       1193583.25       1195393.38       1197203.75       1199013.88       1200824.25       1202634.62       1204444.88       1206255.12       1208065.38       1209875.62       1211685.75       1213496.00       1215306.25       1217116.62       1218927.00       1220737.38       1222547.50       1224357.88       1226168.38       1227978.50       1229788.88    
"""

raw_data_1="""PCOOL:   7214736.50       7214134.00       7213532.50       7212931.50       7212331.50       7211732.00       7211133.50       7210536.00       7209939.00       7209343.00       7208748.00       7208153.50       7207560.00       7206967.50       7206375.50       7205784.50       7205194.00       7204605.00       7203993.00       7203364.50       7202726.50       7202078.50       7201410.50       7200713.50       7200000.00    
 VCOOL:   1.28936708       1.29203391       1.29472733       1.29744399       1.30017996       1.30294347       1.30572951       1.30854285       1.31137776       1.31423879       1.31712890       1.32004344       1.32298291       1.32595122       1.32894814       1.33197105       1.33502340       1.33810496       1.36791003       1.39527667       1.42336583       1.45251524       1.49127460       1.54459631       1.59685826    
 DCOOL:   769.138184       767.550659       765.953918       764.349976       762.741699       761.124146       759.499939       757.867126       756.228638       754.582397       752.927612       751.265381       749.595215       747.917175       746.231201       744.536987       742.834595       741.123840       724.976501       710.756226       696.729309       682.749084       665.004761       642.047546       621.033691    
 TCOOL:   543.600952       544.497192       545.392029       546.284302       547.172302       548.058777       548.942139       549.823425       550.700928       551.575684       552.448059       553.317444       554.183899       555.047363       555.907776       556.765137       557.619446       558.470581       559.336548       559.800415       560.242798       560.658020       560.905945       560.899353       560.892639    
 EPS:   0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       2.00607125E-02   3.91468257E-02   5.80681004E-02   7.70434514E-02  0.101853564      0.134737462      0.164837748    
 XFL:   0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       1.37788698E-03   2.77874386E-03   4.25913418E-03   5.83956856E-03   8.02063290E-03   1.11082280E-02   1.41961314E-02
 TSAT:   561.031921       561.026245       561.020569       561.014893       561.009216       561.003540       560.997925       560.992249       560.986633       560.980957       560.975342       560.969727       560.964111       560.958496       560.952942       560.947327       560.941772       560.936157       560.930420       560.924438       560.918396       560.912292       560.905945       560.899353       560.892639    
 MUT:   9.79331235E-05   9.75431903E-05   9.71548579E-05   9.67685628E-05   9.63849889E-05   9.60028847E-05   9.56228760E-05   9.52444534E-05   9.48682937E-05   9.44938947E-05   9.41210310E-05   9.37499135E-05   9.33804549E-05   9.30126116E-05   9.26463617E-05   9.22816325E-05   9.19183803E-05   9.15565834E-05   9.11885290E-05   9.09912633E-05   9.08031070E-05   9.06264686E-05   9.05633642E-05   9.05659108E-05   9.05685010E-05
 HCOOL:   1189104.12       1193676.38       1198248.62       1202820.88       1207393.00       1211965.25       1216537.50       1221109.75       1225682.00       1230254.12       1234826.38       1239398.62       1243970.75       1248543.00       1253115.25       1257687.38       1262259.62       1266831.88       1271404.25       1275976.38       1280548.75       1285121.12       1289693.50       1294266.00       1298838.50    
"""

raw_data_2 = """PCOOL:   7220116.50       7219512.00       7218909.00       7218308.00       7217708.50       7217110.00       7216514.00       7215919.00       7215294.50       7214651.00       7213992.50       7213269.00       7212498.50       7211695.00       7210856.00       7209979.00       7209061.50       7208100.50       7207094.00       7206040.50       7204937.50       7203783.50       7202577.00       7201316.50       7200000.00    
 VCOOL:   1.29068816       1.29606950       1.30154324       1.30711484       1.31278729       1.31855822       1.32444036       1.33042729       1.37219250       1.41016686       1.45154941       1.53743291       1.64072299       1.74022424       1.83633101       1.92937684       2.01966095       2.10744739       2.19296861       2.27645516       2.35808325       2.43803239       2.51631427       2.59325290       2.66890144    
 DCOOL:   768.351135       765.162781       761.943726       758.694946       755.417847       752.109985       748.771729       745.401001       722.718689       703.260376       683.215088       645.086670       604.473694       569.906799       540.078186       514.028748       491.046631       470.587799       452.231049       435.643311       420.559021       406.763550       394.105988       382.409576       371.566772    
 TCOOL:   544.049927       545.837341       547.615356       549.382935       551.138672       552.883118       554.615601       556.336548       558.368530       559.563477       560.672546       561.018066       561.010803       561.003174       560.995239       560.987000       560.978333       560.969238       560.959717       560.949768       560.939331       560.928406       560.916992       560.905090       560.892639    
 EPS:   0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       2.57284120E-02   5.04237339E-02   7.63422176E-02  0.130123213      0.188309357      0.237833545      0.280569166      0.317890525      0.350817442      0.380129337      0.406429559      0.430195272      0.451806873      0.471572101      0.489706725      0.506464303      0.521998763    
 XFL:   0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       1.74778234E-03   3.61510110E-03   5.78237651E-03   1.06810778E-02   1.68377329E-02   2.29954459E-02   2.91535445E-02   3.53128016E-02   4.14730385E-02   4.76343781E-02   5.37966006E-02   5.99599406E-02   6.61244243E-02   7.22902268E-02   7.84568861E-02   8.46247077E-02   9.07938108E-02
 TSAT:   561.082764       561.077026       561.071350       561.065674       561.059998       561.054382       561.048706       561.043091       561.037231       561.031128       561.024902       561.018066       561.010803       561.003174       560.995300       560.987000       560.978333       560.969238       560.959717       560.949768       560.939331       560.928406       560.916992       560.905090       560.892639    
 MUT:   9.77394593E-05   9.69639732E-05   9.61961559E-05   9.54359857E-05   9.46835717E-05   9.39382080E-05   9.31996983E-05   9.24673877E-05   9.16037607E-05   9.10960007E-05   9.06246714E-05   9.05200868E-05   9.05228881E-05   9.05258348E-05   9.05288689E-05   9.05320776E-05   9.05354173E-05   9.05389315E-05   9.05426059E-05   9.05464476E-05   9.05504785E-05   9.05546913E-05   9.05591005E-05   9.05636916E-05   9.05685010E-05
 HCOOL:   1193675.62       1202819.25       1211963.00       1221106.50       1230250.12       1239393.88       1248537.38       1257681.00       1266824.75       1275968.50       1285112.25       1294256.25       1303400.38       1312544.62       1321689.00       1330833.50       1339978.25       1349123.25       1358268.25       1367413.50       1376559.00       1385704.62       1394850.62       1403996.75       1413143.12    
"""

raw_data_4= """PCOOL:   7238685.00       7238077.00       7237471.50       7236832.00       7236175.50       7235439.50       7234556.00       7233609.50       7232588.00       7231481.00       7230280.50       7228979.00       7227569.00       7226045.50       7224401.00       7222630.00       7220727.50       7218686.50       7216501.00       7214165.50       7211673.00       7209017.50       7206191.50       7203188.00       7200000.00    
 VCOOL:   1.29332840       1.30427396       1.31561303       1.37010872       1.41899037       1.52465987       1.72751021       1.91663110       2.09455252       2.26327753       2.42442417       2.57931685       2.72872972       2.87379694       3.01512837       3.15330768       3.28884196       3.42216372       3.55364132       3.68360710       3.81233335       3.94007277       4.06705141       4.19345808       4.31947279    
 DCOOL:   766.782288       760.347961       753.793945       723.813171       698.879150       650.454163       574.074036       517.429260       473.476013       438.178619       409.052917       384.488770       363.435455       345.088745       328.913300       314.499756       301.538910       289.791138       279.069000       269.222870       260.131744       251.697479       243.838547       236.487686       229.587830    
 TCOOL:   544.944885       548.499878       552.012146       556.596069       559.420898       561.227295       561.218933       561.210022       561.200378       561.189941       561.178711       561.166382       561.153076       561.138672       561.123169       561.106445       561.088501       561.069214       561.048584       561.026550       561.002991       560.977905       560.951172       560.922791       560.892639    
 EPS:   0.00000000       0.00000000       0.00000000       2.85890754E-02   5.70114367E-02  0.121964552      0.231464371      0.312671304      0.375683486      0.426286429      0.468041569      0.503256738      0.533438563      0.559739769      0.582927823      0.603589416      0.622167826      0.639006555      0.654374182      0.668485105      0.681512892      0.693598032      0.704857409      0.715387344      0.725269616    
 XFL:   0.00000000       0.00000000       0.00000000       1.88544265E-03   4.11176402E-03   9.93513595E-03   2.22375412E-02   3.45411859E-02   4.68465276E-02   5.91535904E-02   7.14628845E-02   8.37740079E-02   9.60873961E-02  0.108403109      0.120720871      0.133041039      0.145363376      0.157688111      0.170014933      0.182343856      0.194675103      0.207008258      0.219343722      0.231680989      0.244020239    
 TSAT:   561.257874       561.252136       561.246460       561.240417       561.234192       561.227295       561.218933       561.210022       561.200378       561.189941       561.178650       561.166382       561.153076       561.138672       561.123169       561.106445       561.088501       561.069214       561.048584       561.026550       561.002991       560.977905       560.951172       560.922791       560.892639    
 MUT:   9.73567221E-05   9.58217788E-05   9.43168852E-05   9.23644257E-05   9.11643510E-05   9.04393601E-05   9.04425833E-05   9.04460248E-05   9.04497429E-05   9.04537665E-05   9.04581248E-05   9.04628541E-05   9.04679910E-05   9.04735498E-05   9.04795306E-05   9.04859844E-05   9.04929038E-05   9.05003471E-05   9.05083070E-05   9.05168126E-05   9.05259003E-05   9.05355846E-05   9.05459019E-05   9.05568595E-05   9.05685010E-05
 HCOOL:   1202818.50       1221105.00       1239391.50       1257678.00       1275964.62       1294251.62       1312538.62       1330826.12       1349113.88       1367401.88       1385690.50       1403979.62       1422269.00       1440559.00       1458849.50       1477140.75       1495432.62       1513725.38       1532018.75       1550313.00       1568608.12       1586904.12       1605201.38       1623499.50       1641798.75    
"""
z, TempVap, TempLiq, TempFuelC, TempStru, Void, Pressure, VelzVap, VelzLiq = [], [], [], [], [], [], [], [], []

# Traitement de chaque ligne pour extraire les valeurs numériques
def extraire(var_name, line_nb, data_name):
    data_lines = data_name.strip().split("\n")
    values = data_lines[line_nb].split(":")[1]
    # Séparation des valeurs en une liste de flottants
    for value in values.split():
        var_name.append(float(value))
    return

# Valeurs THM
PCOOL0=[]
PCOOL1=[]
PCOOL2=[]
PCOOL4=[]
extraire(PCOOL0, 0, raw_data_0)
extraire(PCOOL1, 0, raw_data_1)
extraire(PCOOL2, 0, raw_data_2)
extraire(PCOOL4, 0, raw_data_4)

VCOOL0=[]
VCOOL1=[]
VCOOL2=[]
VCOOL4=[]
extraire(VCOOL0, 1, raw_data_0)
extraire(VCOOL1, 1, raw_data_1)
extraire(VCOOL2, 1, raw_data_2)
extraire(VCOOL4, 1, raw_data_4)

EPS0=[]
EPS1=[]
EPS2=[]
EPS4=[]
extraire(EPS0, 4, raw_data_0)
extraire(EPS1, 4, raw_data_1)
extraire(EPS2, 4, raw_data_2)
extraire(EPS4, 4, raw_data_4)

TCOOL0=[]
TCOOL1=[]
TCOOL2=[]
TCOOL4=[]
extraire(TCOOL0, 3, raw_data_0)
extraire(TCOOL1, 3, raw_data_1)
extraire(TCOOL2, 3, raw_data_2)
extraire(TCOOL4, 3, raw_data_4)

VCOOL=[VCOOL4, VCOOL2, VCOOL1, VCOOL0]
PCOOL=[PCOOL4, PCOOL2, PCOOL1, PCOOL0]
EPS=[EPS4, EPS2, EPS1, EPS0]
TCOOL=[TCOOL4, TCOOL2, TCOOL1, TCOOL0]


powers = [4, 2, 1, 0]
for i in powers:
    X = readTPF(rf"THM_prototype/TPF/graph_axial_{i}e9W.txt")
    z.append(X[0])
    TempVap.append(X[1])
    TempLiq.append(X[2])
    TempFuelC.append(X[3])
    TempStru.append(X[4])
    Void.append(X[5])
    Pressure.append(X[6])
    VelzVap.append(X[7])
    VelzLiq.append(X[8])

colors = ['blue', 'red', 'green', 'orange']

fig, ax = plt.subplots()
for i in range(len(z)):
    #ax.step(caseMerge[i].convection_sol.z_mesh, caseMerge[i].convection_sol.T_water, label=f"THM_p {powers[i]} GW/m3", color=colors[i])
    #ax.step(z[i], TempVap[i], label=f"TPF {powers[i]} GW/m3", linestyle='--', color = colors[i])
    ax.step(z[i], TCOOL[i], label=f"THM {powers[i]} GW/m3", linestyle='--', color = colors[i])
    ax.step(z[i], TempLiq[i], label=f"TPF {powers[i]} GW/m3", linestyle='-', color = colors[i])
ax.set_xlabel("Axial position in m")
ax.set_ylabel("Temperature in K")
ax.grid()
ax.legend(loc="best")
plt.savefig(rf'/home/p122173/Version5_BWR/Version5_ev3727/Donjon/data/results_marie/TPF_THM_temp.png', bbox_inches='tight')

fig1, ax1 = plt.subplots()
for i in range(len(z)):
    #ax1.step(caseMerge[i].convection_sol.z_mesh, caseMerge[i].convection_sol.voidFraction[-1], label=f"THM_p {powers[i]} GW/m3", color=colors[i])
    ax1.step(z[i], EPS[i], label=f"THM {powers[i]} GW/m3", linestyle='-', color = colors[i])
    ax1.step(z[i], Void[i], label=f"TPF {powers[i]} GW/m3", linestyle='--', color = colors[i])
ax1.set_xlabel("Axial position in m")
ax1.set_ylabel("Void fraction")
ax1.grid()
ax1.legend(loc="best")
fig1.savefig(rf'/home/p122173/Version5_BWR/Version5_ev3727/Donjon/data/results_marie/TPF_THM_void.png', bbox_inches='tight')

fig2, ax2 = plt.subplots()
for i in range(len(z)):
    #ax2.step(caseMerge[i].convection_sol.z_mesh, caseMerge[i].convection_sol.P[-1], label=f"THM_p {powers[i]} GW/m3", color=colors[i])
    ax2.step(z[i], PCOOL[i], label=f"THM {powers[i]} GW/m3", linestyle='-', color = colors[i])
    ax2.step(z[i], Pressure[i], label=f"TPF {powers[i]} GW/m3", linestyle='--', color = colors[i])
ax2.set_xlabel("Axial position in m")
ax2.set_ylabel("Pressure in Pa")
ax2.grid()
ax2.legend(loc="best")
fig2.savefig(rf'/home/p122173/Version5_BWR/Version5_ev3727/Donjon/data/results_marie/TPF_THM_pressure.png', bbox_inches='tight')

fig3, ax3 = plt.subplots()
for i in range(len(z)):
    #ax3.step(caseMerge[i].convection_sol.z_mesh, caseMerge[i].convection_sol.Ul, label=f"THM_p {powers[i]} GW/m3", color=colors[i])
    ax3.step(z[i], VCOOL[i], label=f"THM {powers[i]} GW/m3", linestyle='-', color = colors[i])
    ax3.step(z[i], VelzLiq[i], label=f"TPF {powers[i]} GW/m3", linestyle='--', color = colors[i])
ax3.set_xlabel("Axial position in m")
ax3.set_ylabel("Liquid velocity in m/s")
ax3.grid()
ax3.legend(loc="best")
fig3.savefig(rf'/home/p122173/Version5_BWR/Version5_ev3727/Donjon/data/results_marie/TPF_THM_velocity.png', bbox_inches='tight')

fig4, ax4 = plt.subplots()
for i in range(len(z)):
    #ax4.step(caseMerge[i].convection_sol.z_mesh, caseMerge[i].convection_sol.Ug, label=f"THM_p {powers[i]} GW/m3", color=colors[i])
    ax4.step(z[i], VelzVap[i], label=f"TPF {powers[i]} GW/m3", linestyle='-', color = colors[i])
ax4.set_xlabel("Axial position in m")
ax4.set_ylabel("Vapor velocity in m/s")
ax4.grid()
ax4.legend(loc="best")
fig4.savefig(rf'/home/p122173/Version5_BWR/Version5_ev3727/Donjon/data/results_marie/TPF_THM_velocity_vapor.png', bbox_inches='tight')

plt.show()


