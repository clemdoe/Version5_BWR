import numpy as np 
import matplotlib.pyplot as plt
import pandas as pd 

def readTPF(file_path):
    # Charger les données
    df = pd.read_csv(file_path, delimiter=',', skipinitialspace=True)
    z = df['zPosition']
    # Convertir les colonnes de température en float
    TempVap = df['TempVap'].astype(float)
    TempLiq = df['TempLiq'].astype(float)
    TempFuelC = df['TempFuelC'].astype(float)
    TempStru = df['TempStru'].astype(float)
    Void = df['Void'].astype(float)
    Pressure = df['Pressure'].astype(float)
    VelzVap = df['VelzVap'].astype(float)
    VelzLiq = df['VelzLiq'].astype(float)

    for i in range(len(z)):
        TempVap[i] = TempVap[i] + 273.15
        TempLiq[i] = TempLiq[i] + 273.15
        TempFuelC[i] = TempFuelC[i] + 273.15
        TempStru[i] = TempStru[i] + 273.15
        
    return z, TempVap, TempLiq, TempFuelC, TempStru, Void, Pressure, VelzVap, VelzLiq


# Données brutes sous forme de chaîne de caractères
raw_data_0 = """PCOOL:   7214343.00       7213741.50       7213140.50       7212540.00       7211939.50       7211339.50       7210739.50       7210140.50       7209541.00       7208942.50       7208344.00       7207746.00       7207148.00       7206550.50       7205953.50       7205356.50       7204760.00       7204164.00       7203568.00       7202972.50       7202377.50       7201782.50       7201188.00       7200594.00       7200000.00    
 VCOOL:   1.28856492       1.28961909       1.29067171       1.29173470       1.29279423       1.29386306       1.29492974       1.29600608       1.29708052       1.29816306       1.29924941       1.30033696       1.30142891       1.30252469       1.30362487       1.30472767       1.30583715       1.30694664       1.30806339       1.30918074       1.31030595       1.31143272       1.31256473       1.31369948       1.31483805    
 DCOOL:   769.617004       768.987915       768.360718       767.728455       767.099243       766.465576       765.834167       765.198181       764.564331       763.926758       763.287903       762.649597       762.009583       761.368408       760.726074       760.083130       759.437317       758.792603       758.144714       757.497742       756.847046       756.197144       755.544678       754.892456       754.237366    
 TCOOL:   543.329163       543.685608       544.039795       544.395996       544.749390       545.104248       545.456848       545.810913       546.162781       546.515686       546.868225       547.219421       547.570496       547.921143       548.271423       548.620972       548.971008       549.319336       549.668396       550.015747       550.364197       550.711121       551.058289       551.404175       551.750549    
 EPS:   0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000    
 XFL:   0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000    
 TSAT:   561.028198       561.022522       561.016846       561.011169       561.005493       560.999817       560.994202       560.988525       560.982849       560.977173       560.971558       560.965881       560.960205       560.954590       560.948914       560.943298       560.937622       560.932007       560.926392       560.920715       560.915100       560.909485       560.903870       560.898254       560.892639    
 MUT:   9.80513869E-05   9.78959506E-05   9.77416494E-05   9.75866351E-05   9.74330032E-05   9.72788766E-05   9.71258851E-05   9.69723988E-05   9.68200038E-05   9.66672960E-05   9.65148793E-05   9.63631755E-05   9.62116537E-05   9.60604375E-05   9.59094905E-05   9.57589800E-05   9.56083750E-05   9.54586067E-05   9.53086346E-05   9.51594920E-05   9.50099784E-05   9.48612069E-05   9.47124281E-05   9.45642823E-05   9.44160056E-05
 HCOOL:   1186342.25       1188152.50       1189962.88       1191773.00       1193583.25       1195393.38       1197203.75       1199013.88       1200824.25       1202634.62       1204444.88       1206255.12       1208065.38       1209875.62       1211685.75       1213496.00       1215306.25       1217116.62       1218927.00       1220737.38       1222547.50       1224357.88       1226168.38       1227978.50       1229788.88    
"""

raw_data_1="""PCOOL:   7214648.00       7214045.50       7213444.00       7212843.00       7212243.00       7211643.50       7211045.00       7210447.50       7209850.50       7209254.50       7208659.50       7208065.00       7207471.50       7206879.00       7206287.00       7205696.00       7205105.50       7204516.50       7203904.50       7203277.00       7202641.00       7201996.00       7201342.00       7200678.50       7200000.00    
 VCOOL:   1.28936708       1.29203475       1.29472744       1.29744363       1.30018187       1.30294347       1.30572963       1.30854356       1.31137776       1.31424165       1.31712723       1.32004178       1.32298541       1.32595110       1.32894826       1.33197105       1.33502328       1.33810496       1.36738503       1.39379382       1.42038393       1.44739127       1.47522092       1.50430644       1.54363000    
 DCOOL:   769.139771       767.552063       765.953735       764.350098       762.741577       761.123962       759.499695       757.867188       756.227783       754.580444       752.926514       751.263733       749.595032       747.916931       746.230835       744.536621       742.834351       741.123718       725.253052       711.508911       698.185974       685.153870       672.212524       659.175476       642.646179    
 TCOOL:   543.600037       544.496338       545.392029       546.284119       547.172302       548.058777       548.942200       549.823303       550.701294       551.576660       552.448608       553.318176       554.183960       555.047424       555.907898       556.765320       557.619507       558.470581       559.239929       559.612610       559.967773       560.299805       560.599670       560.857605       560.892639    
 EPS:   0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       1.99153032E-02   3.85453515E-02   5.66638596E-02   7.44655505E-02   9.22530144E-02  0.110310167      0.133895144    
 XFL:   0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       1.36515440E-03   2.72427336E-03   4.12707590E-03   5.58701716E-03   7.12896744E-03   8.78042728E-03   1.10237887E-02
 TSAT:   561.031128       561.025391       561.019714       561.014038       561.008362       561.002686       560.997070       560.991394       560.985779       560.980164       560.974487       560.968872       560.963257       560.957703       560.952087       560.946472       560.940918       560.935364       560.929565       560.923645       560.917603       560.911499       560.905334       560.899048       560.892639    
 MUT:   9.79334945E-05   9.75435323E-05   9.71548288E-05   9.67686137E-05   9.63849598E-05   9.60028556E-05   9.56228178E-05   9.52444752E-05   9.48681118E-05   9.44934436E-05   9.41207691E-05   9.37495715E-05   9.33803967E-05   9.30125534E-05   9.26462744E-05   9.22815234E-05   9.19183221E-05   9.15565470E-05   9.12295363E-05   9.10710078E-05   9.09199080E-05   9.07786234E-05   9.06509886E-05   9.05660272E-05   9.05685010E-05
 HCOOL:   1189104.12       1193676.38       1198248.62       1202820.88       1207393.12       1211965.38       1216537.62       1221110.00       1225682.25       1230254.38       1234826.62       1239398.88       1243971.25       1248543.50       1253115.75       1257687.88       1262260.00       1266832.25       1270870.00       1274895.00       1278887.88       1282838.88       1286737.12       1290571.12       1294104.50    
"""

raw_data_2 = """PCOOL:   7218490.50       7217886.00       7217283.50       7216682.00       7216082.50       7215484.50       7214888.00       7214293.00       7213669.00       7213027.50       7212372.00       7211692.50       7210962.00       7210208.00       7209429.50       7208624.50       7207792.00       7206931.00       7206039.50       7205117.00       7204162.00       7203174.00       7202151.50       7201093.50       7200000.00    
 VCOOL:   1.29069161       1.29607022       1.30154550       1.30711937       1.31279087       1.31856251       1.32444668       1.33043122       1.37155020       1.40824544       1.44733930       1.49761605       1.57779574       1.65457118       1.72843087       1.79976714       1.86890614       1.93608999       2.00155640       2.06548452       2.12803531       2.18933606       2.24951339       2.30867457       2.36689448    
 DCOOL:   768.350708       765.159058       761.940186       758.692566       755.414917       752.108276       748.768066       745.398499       723.054565       704.212708       685.193359       662.204102       628.527710       599.338684       573.717407       550.982422       530.624634       512.248901       495.548035       480.275940       466.234650       453.261353       441.222595       430.007172       419.521393    
 TCOOL:   544.048889       545.838013       547.615906       549.382812       551.138794       552.882629       554.616150       556.336365       558.244324       559.317444       560.299927       561.003174       560.996277       560.989136       560.981812       560.974182       560.966309       560.958191       560.949768       560.941040       560.932007       560.922668       560.912964       560.902954       560.892639    
 EPS:   0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       2.55646799E-02   4.96743061E-02   7.44088888E-02  0.105639525      0.153887749      0.195707202      0.232415333      0.264988482      0.294155955      0.320483893      0.344412357      0.366293728      0.386411846      0.404999822      0.422248989      0.438318312      0.453342259    
 XFL:   0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       0.00000000       1.73225882E-03   3.54143186E-03   5.58217522E-03   8.37717205E-03   1.30662639E-02   1.76920220E-02   2.22650860E-02   2.67949924E-02   3.12888511E-02   3.57532725E-02   4.01930958E-02   4.46128249E-02   4.90161404E-02   5.34064472E-02   5.77864051E-02   6.21581823E-02   6.65238649E-02
 TSAT:   561.067383       561.061707       561.055969       561.050293       561.044678       561.039001       561.033386       561.027771       561.021851       561.015808       561.009583       561.003174       560.996277       560.989136       560.981812       560.974182       560.966309       560.958191       560.949768       560.941040       560.932007       560.922668       560.912964       560.902954       560.892639    
 MUT:   9.77393938E-05   9.69631583E-05   9.61953920E-05   9.54354982E-05   9.46829750E-05   9.39378660E-05   9.31989052E-05   9.24668930E-05   9.16559366E-05   9.11999086E-05   9.07823633E-05   9.05258348E-05   9.05284978E-05   9.05312481E-05   9.05340785E-05   9.05370252E-05   9.05400593E-05   9.05431953E-05   9.05464476E-05   9.05498164E-05   9.05533016E-05   9.05569032E-05   9.05606576E-05   9.05645211E-05   9.05685010E-05
 HCOOL:   1193675.62       1202819.25       1211963.00       1221106.62       1230250.25       1239394.00       1248537.75       1257681.38       1266142.62       1274549.25       1282832.25       1290741.12       1297698.75       1304560.88       1311344.00       1318061.62       1324724.75       1331343.00       1337923.62       1344473.25       1350997.38       1357501.00       1363988.00       1370461.88       1376925.75    
"""

raw_data_4= """PCOOL:   7230546.50       7229938.00       7229333.00       7228693.50       7228038.50       7227341.00       7226523.50       7225663.50       7224753.00       7223787.50       7222761.00       7221669.00       7220508.50       7219275.00       7217965.50       7216577.00       7215106.00       7213549.50       7211904.50       7210168.00       7208336.50       7206407.00       7204377.00       7202242.00       7200000.00    
 VCOOL:   1.29334688       1.30429351       1.31563377       1.36956787       1.41714597       1.49067843       1.64780414       1.79303622       1.92915261       2.05806279       2.18113208       2.29939055       2.41364479       2.52453303       2.63234329       2.73774934       2.84100032       2.94238091       3.04214859       3.14050579       3.23765182       3.33375168       3.42896056       3.52340150       3.61719275    
 DCOOL:   766.771484       760.335876       753.782471       724.098877       699.789307       665.263489       601.826294       553.085815       514.068237       481.873993       454.686279       431.296112       410.869263       392.806763       376.701172       362.176544       348.991455       336.943817       325.871002       315.643616       306.153625       297.311127       289.040466       281.278992       273.973083    
 TCOOL:   544.944275       548.499634       552.011292       556.457520       559.132202       561.150940       561.143188       561.135071       561.126526       561.117310       561.107727       561.097412       561.086426       561.074829       561.062439       561.049316       561.035400       561.020752       561.005188       560.988770       560.971436       560.953247       560.934021       560.913818       560.892639    
 EPS:   0.00000000       0.00000000       0.00000000       2.85268761E-02   5.64188175E-02  0.100914434      0.191836730      0.261695027      0.317618132      0.363761753      0.402729601      0.436254680      0.465532362      0.491421133      0.514504850      0.535322428      0.554219782      0.571486533      0.587355793      0.602012873      0.615612686      0.628283978      0.640135169      0.651256025      0.661723375    
 XFL:   0.00000000       0.00000000       0.00000000       1.87635352E-03   4.04399168E-03   7.97254965E-03   1.72887333E-02   2.63922215E-02   3.53540964E-02   4.42219861E-02   5.30279838E-02   6.17957972E-02   7.05411881E-02   7.92759135E-02   8.80100876E-02   9.67462361E-02  0.105489999      0.114243917      0.123010255      0.131788820      0.140580326      0.149385884      0.158206090      0.167040825      0.175889686    
 TSAT:   561.181152       561.175415       561.169739       561.163696       561.157471       561.150940       561.143188       561.135071       561.126526       561.117371       561.107727       561.097412       561.086426       561.074768       561.062439       561.049316       561.035400       561.020752       561.005188       560.988770       560.971436       560.953247       560.934021       560.913818       560.892639    
 MUT:   9.73543865E-05   9.58192104E-05   9.43144987E-05   9.24204505E-05   9.12840042E-05   9.04688131E-05   9.04718036E-05   9.04749395E-05   9.04782355E-05   9.04817643E-05   9.04854824E-05   9.04894623E-05   9.04937042E-05   9.04982080E-05   9.05029592E-05   9.05080233E-05   9.05134002E-05   9.05190464E-05   9.05250563E-05   9.05313937E-05   9.05380875E-05   9.05451016E-05   9.05525230E-05   9.05603229E-05   9.05685010E-05
 HCOOL:   1202818.50       1221105.00       1239391.50       1256935.00       1274332.00       1290922.00       1304767.25       1318294.62       1331609.62       1344782.50       1357861.88       1370882.00       1383866.75       1396833.62       1409797.88       1422762.75       1435736.88       1448724.50       1461728.25       1474748.25       1487785.38       1500841.88       1513918.00       1527014.00       1540129.38    
"""
z, TempVap, TempLiq, TempFuelC, TempStru, Void, Pressure, VelzVap, VelzLiq = [], [], [], [], [], [], [], [], []

# Traitement de chaque ligne pour extraire les valeurs numériques
def extraire(var_name, line_nb, data_name):
    data_lines = data_name.strip().split("\n")
    values = data_lines[line_nb].split(":")[1]
    # Séparation des valeurs en une liste de flottants
    for value in values.split():
        var_name.append(float(value))
    return

# Valeurs THM
PCOOL0=[]
PCOOL1=[]
PCOOL2=[]
PCOOL4=[]
extraire(PCOOL0, 0, raw_data_0)
extraire(PCOOL1, 0, raw_data_1)
extraire(PCOOL2, 0, raw_data_2)
extraire(PCOOL4, 0, raw_data_4)

VCOOL0=[]
VCOOL1=[]
VCOOL2=[]
VCOOL4=[]
extraire(VCOOL0, 1, raw_data_0)
extraire(VCOOL1, 1, raw_data_1)
extraire(VCOOL2, 1, raw_data_2)
extraire(VCOOL4, 1, raw_data_4)

EPS0=[]
EPS1=[]
EPS2=[]
EPS4=[]
extraire(EPS0, 4, raw_data_0)
extraire(EPS1, 4, raw_data_1)
extraire(EPS2, 4, raw_data_2)
extraire(EPS4, 4, raw_data_4)

TCOOL0=[]
TCOOL1=[]
TCOOL2=[]
TCOOL4=[]
extraire(TCOOL0, 3, raw_data_0)
extraire(TCOOL1, 3, raw_data_1)
extraire(TCOOL2, 3, raw_data_2)
extraire(TCOOL4, 3, raw_data_4)

VCOOL=[VCOOL4, VCOOL2, VCOOL1, VCOOL0]
PCOOL=[PCOOL4, PCOOL2, PCOOL1, PCOOL0]
EPS=[EPS4, EPS2, EPS1, EPS0]
TCOOL=[TCOOL4, TCOOL2, TCOOL1, TCOOL0]


powers = [4,2,1,0]
powerskW = [38.4, 19.2, 9.6, 3.8]

for i in powers:
    X = readTPF(rf"THM_prototype/TPF/graph_axial_{i}e9W.txt")
    z.append(X[0])
    TempVap.append(X[1])
    TempLiq.append(X[2])
    TempFuelC.append(X[3])
    TempStru.append(X[4])
    Void.append(X[5])
    Pressure.append(X[6])
    VelzVap.append(X[7])
    VelzLiq.append(X[8])

colors = ['blue', 'red', 'green', 'orange']

fig, ax = plt.subplots()
for i in range(len(z)):
    #ax.step(caseMerge[i].convection_sol.z_mesh, caseMerge[i].convection_sol.T_water, label=f"THM_p {powerskW[i]} kW", color=colors[i])
    #ax.step(z[i], TempVap[i], label=f"TPF {powerskW[i]} kW", linestyle='--', color = colors[i])
    ax.step(z[i], TCOOL[i], label=f"THM {powerskW[i]} kW", linestyle='--', color = colors[i])
    ax.step(z[i], TempLiq[i], label=f"TPF {powerskW[i]} kW", linestyle='-', color = colors[i])
ax.set_xlabel("Axial position in m")
ax.set_ylabel("Temperature in K")
ax.grid()
ax.legend(loc="best")
plt.savefig(rf'/home/p122173/Version5_BWR/Version5_ev3727/Donjon/data/results_marie/TPF_THM_temp.png', bbox_inches='tight')

fig1, ax1 = plt.subplots()
for i in range(len(z)):
    #ax1.step(caseMerge[i].convection_sol.z_mesh, caseMerge[i].convection_sol.voidFraction[-1], label=f"THM_p {powerskW[i]} kW", color=colors[i])
    ax1.step(z[i], EPS[i], label=f"THM {powerskW[i]} kW", linestyle='-', color = colors[i])
    ax1.step(z[i], Void[i], label=f"TPF {powerskW[i]} kW", linestyle='--', color = colors[i])
ax1.set_xlabel("Axial position in m")
ax1.set_ylabel("Void fraction")
ax1.grid()
ax1.legend(loc="best")
fig1.savefig(rf'/home/p122173/Version5_BWR/Version5_ev3727/Donjon/data/results_marie/TPF_THM_void.png', bbox_inches='tight')

fig2, ax2 = plt.subplots()
for i in range(len(z)):
    #ax2.step(caseMerge[i].convection_sol.z_mesh, caseMerge[i].convection_sol.P[-1], label=f"THM_p {powerskW[i]} kW", color=colors[i])
    ax2.step(z[i], PCOOL[i], label=f"THM {powerskW[i]} kW", linestyle='-', color = colors[i])
    ax2.step(z[i], Pressure[i], label=f"TPF {powerskW[i]} kW", linestyle='--', color = colors[i])
ax2.set_xlabel("Axial position in m")
ax2.set_ylabel("Pressure in Pa")
ax2.grid()
ax2.legend(loc="best")
fig2.savefig(rf'/home/p122173/Version5_BWR/Version5_ev3727/Donjon/data/results_marie/TPF_THM_pressure.png', bbox_inches='tight')

fig21, ax21 = plt.subplots()
for i in (0,1):
    ax21.step(z[i], PCOOL[i], label=f"THM {powerskW[i]} kW", linestyle='-', color = colors[i])
    ax21.step(z[i], Pressure[i], label=f"TPF {powerskW[i]} kW", linestyle='--', color = colors[i])
ax21.set_xlabel("Axial position in m")
ax21.set_ylabel("Pressure in Pa")   
ax21.grid()
ax21.legend(loc="best")
fig21.savefig(rf'/home/p122173/Version5_BWR/Version5_ev3727/Donjon/data/results_marie/TPF_THM_pressure_1.png', bbox_inches='tight')

fig22, ax22 = plt.subplots()
for i in (2,3):
    ax22.step(z[i], PCOOL[i], label=f"THM {powerskW[i]} kW", linestyle='-', color = colors[i])
    ax22.step(z[i], Pressure[i], label=f"TPF {powerskW[i]} kW", linestyle='--', color = colors[i])
ax22.set_xlabel("Axial position in m")
ax22.set_ylabel("Pressure in Pa")
ax22.grid()
ax22.legend(loc="best")
fig22.savefig(rf'/home/p122173/Version5_BWR/Version5_ev3727/Donjon/data/results_marie/TPF_THM_pressure_2.png', bbox_inches='tight')


fig3, ax3 = plt.subplots()
for i in range(len(z)):
    #ax3.step(caseMerge[i].convection_sol.z_mesh, caseMerge[i].convection_sol.Ul, label=f"THM_p {powerskW[i]} kW", color=colors[i])
    ax3.step(z[i], VCOOL[i], label=f"THM {powerskW[i]} kW", linestyle='-', color = colors[i])
    ax3.step(z[i], VelzLiq[i], label=f"TPF {powerskW[i]} kW", linestyle='--', color = colors[i])
ax3.set_xlabel("Axial position in m")
ax3.set_ylabel("Liquid velocity in m/s")
ax3.grid()
ax3.legend(loc="best")
fig3.savefig(rf'/home/p122173/Version5_BWR/Version5_ev3727/Donjon/data/results_marie/TPF_THM_velocity.png', bbox_inches='tight')

fig4, ax4 = plt.subplots()
for i in range(len(z)):
    #ax4.step(caseMerge[i].convection_sol.z_mesh, caseMerge[i].convection_sol.Ug, label=f"THM_p {powerskW[i]} kW", color=colors[i])
    ax4.step(z[i], VelzVap[i], label=f"TPF {powerskW[i]} kW", linestyle='-', color = colors[i])
ax4.set_xlabel("Axial position in m")
ax4.set_ylabel("Vapor velocity in m/s")
ax4.grid()
ax4.legend(loc="best")
fig4.savefig(rf'/home/p122173/Version5_BWR/Version5_ev3727/Donjon/data/results_marie/TPF_THM_velocity_vapor.png', bbox_inches='tight')

plt.show()


